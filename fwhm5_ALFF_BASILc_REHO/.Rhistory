pull(file_paths)
if (length(settings$modalities) == 2) {
file_labels <- c(paste0(settings$modalities[1], "_age"),
paste0(settings$modalities[1], "_sex"),
paste0(settings$modalities[2], "_age"),
paste0(settings$modalities[2], "_sex"))
}
if (length(settings$modalities) == 3) {
file_labels <- c(paste0(settings$modalities[1], "_age"),
paste0(settings$modalities[1], "_sex"),
paste0(settings$modalities[2], "_age"),
paste0(settings$modalities[2], "_sex"),
paste0(settings$modalities[3], "_age"),
paste0(settings$modalities[3], "_sex"))
}
# Modality data on Yeo7
modality_yeo7 <- get_prop_sig(file_paths = modality_file_paths,
file_labels = file_labels,
atlas = yeo7,
mask = settings$mask_path) #TODO
modality_yeo7_barplot <- ggplot(modality_yeo7, aes(network_ids, proportion)) +
geom_col() +
geom_errorbar(aes(ymin = proportion - se, ymax = proportion + se), width = .2,
position = position_dodge(.9)) +
facet_wrap(~ map_name) +
labs(title = "Modality on Yeo7") +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal Attention", "Ventral Attention", "Limbic", "Frontoparietal", "Default")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 90)); modality_yeo7_barplot
ggsave(plot = modality_yeo7_barplot, file.path(settings$output_dir, "figures/barplots", "yeo7_modality_fdr05.png"), type = "cairo-png")
# Modality data on AAL
modality_aal <- get_prop_sig(modality_file_paths, file_labels, aal_sym, settings$mask_path)
modality_aal_barplot <- ggplot(modality_aal, aes(network_ids, proportion)) +
geom_col() +
geom_errorbar(aes(ymin = proportion - se, ymax = proportion + se), width = .2,
position = position_dodge(.9)) +
facet_wrap(~ map_name) +
labs(title = "Modality on AAL") +
scale_x_discrete(labels = c("Hippocampus", "Amygdala", "Caudate", "Putamen", "Pallidum", "Thalamus")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 90)); modality_aal_barplot
ggsave(plot = modality_aal_barplot, file.path(settings$output_dir, "figures/barplots", "aal_modality_fdr05.png"), type = "cairo-png")
write_csv(modality_aal, file.path(settings$output_dir, "csvs/", "modality_aal.csv"))
write_csv(modality_yeo7, file.path(settings$output_dir, "csvs/", "modality_yeo7.csv"))
write_csv(coupled_aal, file.path(settings$output_dir, "csvs/", "coupled_aal.csv"))
write_csv(coupled_yeo7, file.path(settings$output_dir, "csvs/", "coupled_yeo7.csv"))
rm(aal, aal_sym, yeo7, coupled_aal, coupled_aal_barplot, coupled_yeo7, coupled_yeo7_barplot, modality_aal, modality_aal_barplot, modality_yeo7, modality_yeo7_barplot, pval_metadata, all_indices, coupled_file_paths, excluded_indices, file_labels, i, modality_file_paths, subcortical_indices, get_prop_sig)
source(here("R/mri_vol2surf.R"))
split_atlas_into_regions <- function(atlas, atlas_name = c("yeo7", "aal"), region_out_dir) {
dir.create(region_out_dir, showWarnings = FALSE)
atlas[atlas == 0] <- NA
region_names <- atlas %>%
as.factor() %>%
summary() %>%
names()
region_names <- region_names[-length(region_names)]
out_file_names <- region_names %>%
paste0(atlas_name, "_", ., ".nii.gz") %>%
file.path(region_out_dir, .)
mapply(
function(region_name, out_file_name) {
temp <- atlas * 1 # causes R to make a copy of atlas at a new address
temp[atlas == region_name] <- 1
temp[atlas != region_name] <- 0
antsImageWrite(temp, out_file_name)
}, as.numeric(region_names),
out_file_names)
return(out_file_names)
}
get_names <- function(paths) {
names_list <- lapply(paths, function(path) {
split_path <- str_split(path, "/") %>%
unlist()
file_name <- split_path[length(split_path)]
})
unlist(names_list)
}
transform_to_MNI <- function(images, paths, MNI_transform_out_dir) {
MNI <- check_ants(file.path(settings$input_dir, "references/atlases/MNI152_T1_1mm_brain.nii.gz"))
transform_list <- c(file.path(settings$input_dir, "references/transformations/PNC-MNI_0Warp.nii.gz"),
file.path(settings$input_dir, "references/transformations/PNC-MNI_1Affine.mat"))
file_names <- get_names(paths)
mapply(function(image, file_name, MNI, transform_list) {
image_transformed <- antsApplyTransforms(fixed = MNI,
moving = image,
transformlist = transform_list,
interpolator = "nearestNeighbor",
imagetype = 0)
antsImageWrite(image_transformed, file.path(MNI_transform_out_dir, file_name))
return(file.path(MNI_transform_out_dir, file_name))
}, image = images, file_name = file_names,
MoreArgs = list(MNI = MNI, transform_list = transform_list))
}
project_to_surface <- function(image_MNI_paths, out_dir) {
dir.create(out_dir, showWarnings = FALSE)
hemi_paths <- lapply(image_MNI_paths, function(image_path) {
outfile = get_names(image_path) %>% str_remove(".nii.gz") %>% str_glue(".mgh")
lh <- mri_vol2surf(mov = image_path,
target_subject = 'fsaverage5',
opts = "--interp nearest",
outfile = file.path(out_dir, outfile),
hemi = "lh")
rh <- mri_vol2surf(mov = image_path,
target_subject = 'fsaverage5',
opts = "--interp nearest",
outfile = file.path(out_dir, outfile),
hemi = "rh")
c(file.path(lh), file.path(rh))
})
num_files <- length(hemi_paths)
paths_df <- hemi_paths %>%
unlist() %>%
matrix(byrow = TRUE, ncol = 1) %>%
as.data.frame() %>%
rename(paths = "V1") %>%
mutate(hemisphere = rep(c("lh", "rh"), num_files))
paths_df
}
preprocess_for_spin_test <- function(file_paths = NULL, atlas_name = c("", "yeo7", "aal"),
fs_images_dir,
file_path_output_dir = "") {
if (is.null(file_paths)) {
if (atlas_name == "yeo7") {
atlas <- check_ants(file.path(settings$input_dir, "references/atlases/7yeonetworkPNC.nii.gz"))
atlas_output_dir <- "yeo7_regions"
}
if (atlas_name == "aal") {
atlas <- check_ants(file.path(settings$input_dir, "references/atlases/AAL_atlas_PNC.nii.gz"))
atlas_output_dir <- "aal_regions"
for(i in 0:9) {
lower <- i * 1000
upper <- (i + 1) * 1000
atlas[atlas >= lower & atlas < upper] <- lower
}
}
region_paths <- split_atlas_into_regions(atlas,
atlas_name = atlas_name,
file.path(fs_images_dir, "PNC_space", atlas_output_dir))
region_images <- check_ants(region_paths)
region_transformed_paths <- transform_to_MNI(region_images,
region_paths,
file.path(fs_images_dir, "MNI_space", atlas_output_dir))
region_sphere <- project_to_surface(region_transformed_paths,
file.path(fs_images_dir, "surfaces", atlas_output_dir))
return(NULL)
}
if (!is.null(file_paths)) {
pval_images <- check_ants(file_paths)
pval_transformed_paths <- transform_to_MNI(pval_images,
file_paths,
file.path(fs_images_dir, "MNI_space", file_path_output_dir))
pval_sphere <- project_to_surface(pval_transformed_paths,
file.path(fs_images_dir, "surfaces", file_path_output_dir))
return(NULL)
}
}
Sys.setenv(FS_LICENSE="/home/fengling/software/freesurfer/license.txt")
set_fs_subj_dir("/root/software/freesurfer/subjects")
pval_descriptive <- read_csv(file.path(settings$output_dir, "csvs/pval_descriptive_stats.csv"))
pval_coupling_paths <- pval_descriptive %>%
filter(mc_correction == "fdr05",
matrix_type != "modality") %>%
pull(file_paths) %>%
as.list()
pval_modality_paths <- pval_descriptive %>%
filter(mc_correction == "fdr05",
matrix_type == "modality") %>%
pull(file_paths) %>%
as.list()
fs_images_dir <- file.path(settings$output_dir, "freesurfer_images")
#atlas
preprocess_for_spin_test(atlas_name = "yeo7", #TODO should I apply grey matter mask?
fs_images_dir = fs_images_dir)
preprocess_for_spin_test(atlas_name = "aal",
fs_images_dir = fs_images_dir)
#pvals
preprocess_for_spin_test(file_paths = pval_coupling_paths,
fs_images_dir = fs_images_dir,
file_path_output_dir = "pvals/adjusted")
preprocess_for_spin_test(file_paths = pval_modality_paths,
fs_images_dir = fs_images_dir,
file_path_output_dir = "pvals/modality")
#descriptive
preprocess_for_spin_test(file_paths = list.files(file.path(settings$output_dir, "niftis/descriptive"),
full.names = TRUE) %>% as.list(),
fs_images_dir = fs_images_dir,
file_path_output_dir = "descriptive")
rm(pval_coupling_paths, pval_descriptive, pval_modality_paths, fs_images_dir, get_names, mri_vol2surf, mri_vol2surf.help, preprocess_for_spin_test, project_to_surface, split_atlas_into_regions, transform_to_MNI)
library(tidyverse)
library(ggpubr)
library(ggthemes)
library(here)
library(ggprism)
load(here("input/csvs/settings.RData"))
spin_test <- read_csv(file.path(settings$output_dir, "figures/spin_test.csv"))
coupled_aal <- read_csv(file.path(settings$output_dir, "csvs/coupled_aal.csv")) %>%
filter(map_name == "global_age" | map_name == "global_sex")
coupled_aal <- coupled_aal %>%
mutate(
region = case_when(
network_ids == 4100 ~ "Hippocampus",
network_ids == 4200 ~ "Amygdala",
network_ids == 7000 ~ "Caudate",
network_ids == 7010 ~ "Putamen",
network_ids == 7020 ~ "Pallidum",
network_ids == 7100 ~ "Thalamus"))
coupled_yeo7 <- read_csv(file.path(settings$output_dir, "csvs/coupled_yeo7.csv")) %>%
filter(map_name == "global_age" | map_name == "global_sex")
coupled_yeo7 <- coupled_yeo7 %>%
mutate(
region = case_when(
network_ids == 1 ~ "Visual",
network_ids == 2 ~ "Somatomotor",
network_ids == 3 ~ "Dorsal Attention",
network_ids == 4 ~ "Ventral Attention",
network_ids == 5 ~ "Limbic",
network_ids == 6 ~ "Frontoparietal",
network_ids == 7 ~ "Default"))
coupled_yeo7$network_ids <- as.factor(coupled_yeo7$network_ids)
coupled_yeo7 <- coupled_yeo7 %>% cbind(spin_results = c(t(spin_test[1, 2:8]), t(spin_test[3, 2:8])))
title_size <- 25
x_size <- 20
x_angle <- 45
y_axis_size <- 15
y_title_size <- 23
y_title <- "Proportion"
pval_size <- 5
pval_nudge <- 0.01
y_lims_age <- c(0, 0.2)
y_lims_sex <- c(0, 0.2)
age_aal <- ggplot(coupled_aal %>% filter(map_name == "global_age"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_age) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_aal
age_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_age"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_age) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "", "", "p = 0.0125", "p = 0.039"), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_yeo7
sex_aal <- ggplot(coupled_aal %>% filter(map_name == "global_sex"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_sex) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_aal
sex_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_sex"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_sex) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "", "", "p = 0.0115", ""), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_yeo7
age_sex_yeo <- ggarrange(age_aal, sex_aal, age_yeo7, sex_yeo7, nrow = 2, ncol = 2); age_sex_yeo
ggsave(filename = here("output/figures/simulation/joint_barplots_norace.png"), plot = age_sex_yeo, type = "cairo-png", width = 15.083, height = 10.906, dpi = 300)
title_size <- 25
x_size <- 20
x_angle <- 45
y_axis_size <- 15
y_title_size <- 23
y_title <- "Proportion"
pval_size <- 5
pval_nudge <- 0.01
y_lims_age <- c(0, 0.5)
y_lims_sex <- c(0, 0.5)
age_aal <- ggplot(coupled_aal %>% filter(map_name == "global_age"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_age) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_aal
age_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_age"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_age) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "", "", "p = 0.0125", "p = 0.039"), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_yeo7
sex_aal <- ggplot(coupled_aal %>% filter(map_name == "global_sex"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_sex) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_aal
sex_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_sex"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_sex) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "", "", "p = 0.0115", ""), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_yeo7
age_sex_yeo <- ggarrange(age_aal, sex_aal, age_yeo7, sex_yeo7, nrow = 2, ncol = 2); age_sex_yeo
1/2000
.0005* 2000
---
title: "create_barplot"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
library(ggthemes)
library(here)
library(ggprism)
```
```{r}
load(here("input/csvs/settings.RData"))
spin_test <- read_csv(file.path(settings$output_dir, "figures/spin_test.csv"))
coupled_aal <- read_csv(file.path(settings$output_dir, "csvs/coupled_aal.csv")) %>%
filter(map_name == "global_age" | map_name == "global_sex")
coupled_aal <- coupled_aal %>%
mutate(
region = case_when(
network_ids == 4100 ~ "Hippocampus",
network_ids == 4200 ~ "Amygdala",
network_ids == 7000 ~ "Caudate",
network_ids == 7010 ~ "Putamen",
network_ids == 7020 ~ "Pallidum",
network_ids == 7100 ~ "Thalamus"))
coupled_yeo7 <- read_csv(file.path(settings$output_dir, "csvs/coupled_yeo7.csv")) %>%
filter(map_name == "global_age" | map_name == "global_sex")
coupled_yeo7 <- coupled_yeo7 %>%
mutate(
region = case_when(
network_ids == 1 ~ "Visual",
network_ids == 2 ~ "Somatomotor",
network_ids == 3 ~ "Dorsal Attention",
network_ids == 4 ~ "Ventral Attention",
network_ids == 5 ~ "Limbic",
network_ids == 6 ~ "Frontoparietal",
network_ids == 7 ~ "Default"))
coupled_yeo7$network_ids <- as.factor(coupled_yeo7$network_ids)
coupled_yeo7 <- coupled_yeo7 %>% cbind(spin_results = c(t(spin_test[1, 2:8]), t(spin_test[3, 2:8])))
```
```{r}
title_size <- 25
x_size <- 20
x_angle <- 45
y_axis_size <- 15
y_title_size <- 23
y_title <- "Proportion"
pval_size <- 5
pval_nudge <- 0.01
y_lims_age <- c(0, 0.4)
y_lims_sex <- c(0, 0.4)
age_aal <- ggplot(coupled_aal %>% filter(map_name == "global_age"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_age) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_aal
age_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_age"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Age Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_age) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "", "", "p = 0.004", "p < 0.0005"), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); age_yeo7
sex_aal <- ggplot(coupled_aal %>% filter(map_name == "global_sex"),
aes(region, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in AAL Regions") +
scale_y_continuous(limits = y_lims_sex) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_aal
sex_yeo7 <- ggplot(coupled_yeo7 %>% filter(map_name == "global_sex"),
aes(network_ids, proportion)) +
geom_col(fill = "grey69", width = .6) +
labs(x = "", y = y_title,
title = "Sex Associations in Yeo 7 Networks") +
scale_y_continuous(limits = y_lims_sex) +
scale_x_discrete(labels = c("Visual", "Somatomotor", "Dorsal\nAttention", "Ventral\nAttention", "Limbic", "Fronto-\nparietal", "Default")) +
geom_text(label = c("", "", "", "p = 0.0155", "", "", ""), size = pval_size, nudge_y = pval_nudge) +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text.x = element_text(size = x_size, vjust = .5, angle = x_angle),
axis.text.y = element_text(size = y_axis_size),
axis.title.y = element_text(size = y_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); sex_yeo7
```
```{r}
age_sex_yeo <- ggarrange(age_aal, sex_aal, age_yeo7, sex_yeo7, nrow = 2, ncol = 2); age_sex_yeo
ggsave(filename = here("output/figures/simulation/joint_barplots_norace.png"), plot = age_sex_yeo, type = "cairo-png", width = 15.083, height = 10.906, dpi = 300)
```
```{r}
surf_vals <- read_csv(here("output/csvs/coupling_descriptive_surf.csv"))
surf_plot <- ggplot(surf_vals, aes(mean_surf, var_surf)) +
geom_point(color = "grey69") +
geom_smooth(method = 'lm', formula = y ~ x, se = F, colour = "grey22", size = 3) +
labs(x = "Mean", y = "Variance") +
theme(panel.border = element_blank(),
panel.background = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
axis.line = element_line(colour = "black"),
axis.text = element_text(size = axis_size),
axis.title = element_text(size = xy_title_size),
plot.title = element_text(size = title_size, hjust = 0.5)); surf_plot
cor(surf_vals$mean_surf, surf_vals$var_surf)
```
```{r}
health <- read_csv(here("input/csvs/demographics/healthexclude_ltn.csv"))
rest <- read_csv(here("input/csvs/demographics/n1601_RestQAData.csv"))
pcasl <- read_csv(here("input/csvs/demographics/n1601_PcaslQaData.csv"))
t1 <- read_csv(here("input/csvs/demographics/n1601_t1QaData_v2.csv"))
basil_subj <- read_table(here("input/csvs/demographics/basil_subj.txt"), col_names = FALSE)
basil_subj$scanid <- as.numeric(basil_subj$scanid)
binded <- read_csv(here("input/csvs/demographics/binded_demographics.csv"))
total <- health %>%
inner_join(rest, by = c("bblid", "scanid")) %>%
inner_join(pcasl, by = c("bblid", "scanid")) %>%
inner_join(t1, by = c("bblid", "scanid"))
total_test <- total %>% filter(pcaslExclude == 0)
t1_exclude <- total %>% filter(t1PostProcessExclude + fsReviewExclude >= 1)
rest_exclude <- total %>% filter(fsFinalExclude == 0, restExcludeVoxelwise == 1)
```
